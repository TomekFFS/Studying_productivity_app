{% extends 'base.html' %}

{% block content %}
<div class="split-view-container">
    
    <aside class="task-sidebar">
        <h3 class="sidebar-title">All Tasks</h3>
        <ul class="sidebar-list">
            {% for task in tasks %}
                <li class="sidebar-item {% if task.completed %}completed{% endif %}">
                    <span class="status-dot">
                        {% if task.completed %}âœ”{% else %}â—‹{% endif %}
                    </span>
                    <span class="task-text">
                        {% if task.completed %}
                            <s>{{ task.title }}</s>
                        {% else %}
                            {{ task.title }}
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
        </ul>
    </aside>

    <section class="focus-setup-area">
        <div class="setup-card large-card">
            <h2>ðŸŽ¯ Focus Session</h2>
            <p class="text-muted">Configure your session.</p>

            <label class="setup-label">Select Target</label>
            <select id="task-select" class="setup-select large-select">
                <option value="" disabled selected>-- Choose a task --</option>
                {% for task in tasks %}
                    {% if not task.completed %}
                        <option value="{{ task.id }}">{{ task.title }}</option>
                    {% endif %}
                {% endfor %}
            </select>

            <label class="setup-label">Duration</label>
            <div class="mode-selector">
                <button type="button" class="btn-mode selected" id="25" data-time="25">25m</button>
                <button type="button" class="btn-mode" data-time="50">50m</button>
                <button type="button" class="btn-mode" data-time="90">90m</button>
            </div>

            <button id="start-session-btn" class="btn-primary btn-start large-btn">Start Focus</button>
        </div>
    </section>

</div>

<script>
    document.getElementById('start-session-btn').addEventListener('click', function() {
        const taskId = document.getElementById('task-select').value;
        
        const selectedBtn = document.querySelector('.btn-mode.selected');
        const time = selectedBtn ? selectedBtn.dataset.time : 25; //if the user doesn't click any of the options the default is 25
        if (!taskId) {
            alert("Please select a task first!");
            return;
        }
        window.location.href = "{{ url_for('hub.focus_mode', task_id='') }}" + taskId + `?time=${time}`;
    });

    // Simple interaction for time buttons
    document.querySelectorAll('.btn-mode').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
    document.getElementsByClassName('btn-mode selected')
</script>
<style>
    .btn-mode.selected {
        background-color: rgb(69, 117, 189);
    }
</style>
{% endblock %}